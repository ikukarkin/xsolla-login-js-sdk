{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/supports.js","src/xlapi.js","src/main.js"],"names":["f","exports","module","define","amd","window","global","self","this","XL","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","String","prototype","startsWith","searchString","position","indexOf","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","Event","XLApi","projectId","baseUrl","makeApiCall","success","error","XMLHttpRequest","withCredentials","open","method","endpoint","onreadystatechange","readyState","status","JSON","parse","responseText","message","setRequestHeader","send","postBody","getArguments","getSocialsURLs","str","key","encodeURIComponent","loginPassAuth","login","pass","rememberMe","redirectUrl","body","username","password","remember_me","stringify","smsAuth","phoneNumber","_xlapi","ROUTES","LOGIN","REGISTRATION","RECOVER_PASSWORD","ALL_SOCIALS","DEFAULT_CONFIG","errorHandler","loginPassValidator","b","isMarkupSocialsHandlersEnabled","apiUrl","maxXLClickDepth","onlyWidgets","popupBackgroundColor","iframeZIndex","theme","preloader","widgetBaseUrl","route","IFRAME_ID","widgetIframe","createElement","result","_classCallCheck","socialUrls","eventTypes","LOAD","CLOSE","HIDE_POPUP","dispatcher","onHideEvent","bind","options","_this","config","_extends","api","_xlapi2","default","eventMethod","addEventListener","eventer","data","dispatchEvent","Object","keys","map","eventKey","on","redirect_url","loginUrl","login_url","callbackUrl","updateSocialLinks","response","hasOwnProperty","console","setInterval","maxClickDepth","target","el","attributes","parentElement","findAncestor","xlData","nodeValue","authType","prop","_this2","location","href","res","finishAuth","finish","createErrorObject","err","smsAuthStep","arguments","src","getProjectId","locale","fields","getRedirectURL","getCallbackUrl","getTheme","elementId","_this3","width","height","onload","_element","removeChild","_preloader","style","frameBorder","getIframeSrc","id","innerHTML","getElementById","appendChild","parentNode","zIndex","left","top","backgroundColor","_hide","handler","removeEventListener","onCloseEvent","_this4","_show"],"mappings":"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","file":"xl.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/**\n * Created by a.korotaev on 07.11.16.\n */\nif (!String.prototype.startsWith) {\n    String.prototype.startsWith = function(searchString, position) {\n        position = position || 0;\n        return this.indexOf(searchString, position) === position;\n    };\n}\n\nif ( typeof window.CustomEvent !== \"function\" ) {\n    function CustomEvent(event, params) {\n        params = params || {bubbles: false, cancelable: false, detail: undefined};\n        var evt = document.createEvent('CustomEvent');\n        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n        return evt;\n    }\n\n    CustomEvent.prototype = window.Event.prototype;\n\n    window.CustomEvent = CustomEvent;\n}","/**\n * Created by a.korotaev on 24.06.16.\n */\n/**\n * Impelements Xsolla Login Api\n * @param projectId - project's unique identifier\n * @param baseUrl - api endpoint\n * @constructor\n */\n\nvar XLApi = function (projectId, baseUrl) {\n    var self = this;\n    this.baseUrl = baseUrl || '//login.xsolla.com/api/';\n\n    this.projectId = projectId;\n\n    this.makeApiCall = function (params, success, error) {\n        var r = new XMLHttpRequest();\n        r.withCredentials = true;\n        r.open(params.method, self.baseUrl + params.endpoint, true);\n        r.onreadystatechange = function () {\n            if (r.readyState == 4) {\n                if (r.status == 200) {\n                    success(JSON.parse(r.responseText));\n                } else {\n                    if (r.responseText) {\n                        error(JSON.parse(r.responseText));\n                    } else {\n                        error({error: {message: 'Networking error', code: r.status}});\n                    }\n                }\n            }\n        };\n        if (params.method == 'POST') {\n            r.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n            r.send(params.postBody);\n        } else if (params.method == 'GET') {\n            r.send(params.getArguments);\n        }\n    };\n};\n/**\n * Get all avialable social methods auth url\n * @param success - success callback\n * @param error - error callback\n * @param getArguments - additional params to send with request\n */\nXLApi.prototype.getSocialsURLs = function (success, error, getArguments) {\n    var str = \"\";\n    for (var key in getArguments) {\n        if (str != \"\") {\n            str += \"&\";\n        }\n        str += key + \"=\" + encodeURIComponent(getArguments[key]);\n    }\n\n    return this.makeApiCall({method: 'GET', endpoint: 'social/login_urls?' + str, getArguments: null}, success, error);\n};\n\nXLApi.prototype.loginPassAuth = function (login, pass, rememberMe, redirectUrl, success, error) {\n    var body = {\n        username: login,\n        password: pass,\n        remember_me: rememberMe\n    };\n    return this.makeApiCall({method: 'POST', endpoint: 'proxy/login?projectId='+this.projectId + '&redirect_url=' + encodeURIComponent(redirectUrl), postBody: JSON.stringify(body)}, success, error);\n};\n\nXLApi.prototype.smsAuth = function (phoneNumber, success, error) {\n    return this.makeApiCall({method: 'GET', endpoint: 'sms', getArguments: 'phoneNumber=' + phoneNumber}, success, error);\n};\n\nmodule.exports = XLApi;\n","/**\n * Created by a.korotaev on 24.06.16.\n */\nrequire('./supports');\n\nimport XLApi from './xlapi';\n/**\n * Create an `Auth0` instance with `options`\n *\n * @class XL\n * @constructor\n */\n\nconst ROUTES = {\n    LOGIN: '',\n    REGISTRATION: 'registration',\n    RECOVER_PASSWORD: 'reset-password',\n    ALL_SOCIALS: 'other'\n};\n\nconst DEFAULT_CONFIG = {\n    errorHandler: function (a) {\n    },\n    loginPassValidator: function (a, b) {\n        return true;\n    },\n    isMarkupSocialsHandlersEnabled: false,\n    apiUrl: '//login.xsolla.com/api/',\n    maxXLClickDepth: 20,\n    onlyWidgets: false,\n    popupBackgroundColor: 'rgb(187, 187, 187)',\n    iframeZIndex: 1000000,\n    theme: 'app.default.css',\n    preloader: '<div></div>',\n    widgetBaseUrl: 'https://xl-widget.xsolla.com/',\n    route: ROUTES.LOGIN\n};\n\nconst INVALID_LOGIN_ERROR_CODE = 1;\nconst INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE = 2;\n\nconst IFRAME_ID = 'XsollaLoginWidgetIframe';\nconst widgetIframe = document.createElement('iframe');\n\nclass XL {\n    constructor() {\n        this.socialUrls = {};\n        this.eventTypes = {\n            LOAD: 'load',\n            CLOSE: 'close',\n            HIDE_POPUP: 'hide popup'\n        };\n\n        // need for export purposes\n        this.ROUTES = ROUTES;\n\n        this.dispatcher = document.createElement('div');\n        this.onHideEvent = this.onHideEvent.bind(this);\n    }\n\n    init(options) {\n        this.config = Object.assign({}, DEFAULT_CONFIG, options);\n        this.config.popupBackgroundColor = DEFAULT_CONFIG.popupBackgroundColor;\n        this.api = new XLApi(options.projectId, this.config.apiUrl);\n\n        const eventMethod = window.addEventListener ? 'addEventListener' : 'attachEvent';\n        const eventer = window[eventMethod];\n        const messageEvent = eventMethod == 'attachEvent' ? 'onmessage' : 'message';\n\n        // Listen to message from child window\n        eventer(messageEvent, (e) => {\n            let event = new CustomEvent(this.eventTypes[e.data]);\n            this.dispatcher.dispatchEvent(event);\n        }, false);\n\n        Object.keys(this.eventTypes).map((eventKey) => {\n            this.on(this.eventTypes[eventKey]);\n        });\n\n        if(options.popupBackgroundColor) {\n            this.config.popupBackgroundColor = options.popupBackgroundColor;\n        }\n\n        this.dispatcher.addEventListener(this.eventTypes.HIDE_POPUP, this.onHideEvent);\n\n        if (!this.config.onlyWidgets) {\n\n            let params = {};\n            params.projectId = options.projectId;\n            if (this.config.redirectUrl) {\n                params.redirect_url = this.config.redirectUrl;\n            }\n            if (this.config.loginUrl) {\n                params.login_url = this.config.loginUrl;\n            }\n            if (this.config.callbackUrl) {\n                params.login_url = this.config.callbackUrl;\n            }\n\n            const updateSocialLinks = () => {\n                this.api.getSocialsURLs((response) => {\n                    this.socialUrls = {};\n                    for (let key in response) {\n                        if (response.hasOwnProperty(key)) {\n                            this.socialUrls['sn-' + key] = response[key];\n                        }\n                    }\n                }, (e) => {\n                    console.error(e);\n                }, params);\n            };\n\n            updateSocialLinks();\n            setInterval(updateSocialLinks, 1000 * 60 * 59);\n\n            const maxClickDepth = this.config.maxXLClickDepth;\n            // Find closest ancestor with data-xl-auth attribute\n            function findAncestor(el) {\n                if (el.attributes['data-xl-auth']) {\n                    return el;\n                }\n                let i = 0;\n                while ((el = el.parentElement) && !el.attributes['data-xl-auth'] && ++i < maxClickDepth);\n                return el;\n            }\n\n            if (this.config.isMarkupSocialsHandlersEnabled) {\n                document.addEventListener('click', (e) => {\n                    const target = findAncestor(e.target);\n                    // Do nothing if click was outside of elements with data-xl-auth\n                    if (!target) {\n                        return;\n                    }\n                    const xlData = target.attributes['data-xl-auth'];\n                    if (xlData) {\n                        let nodeValue = xlData.nodeValue;\n                        if (nodeValue) {\n                            this.login({authType: nodeValue});\n                        }\n                    }\n                });\n            }\n        }\n    }\n\n    /**\n     * Performs login\n     * @param prop\n     * @param error - call in case error\n     * @param success\n     */\n    login(prop, error, success) {\n\n        if (!prop || !this.socialUrls) {\n            return;\n        }\n\n        /**\n         * props\n         * authType: sn-<social name>, login-pass, sms\n         */\n        if (prop.authType) {\n            if (prop.authType.startsWith('sn-')) {\n                const socialUrl = this.socialUrls[prop.authType];\n                if (socialUrl != undefined) {\n                    window.location.href = this.socialUrls[prop.authType];\n                } else {\n                    console.error('Auth type: ' + prop.authType + ' doesn\\'t exist');\n                }\n\n            } else if (prop.authType == 'login-pass') {\n                this.api.loginPassAuth(prop.login, prop.pass, prop.rememberMe, this.config.redirectUrl, (res) => {\n                    if (res.login_url) {\n                        const finishAuth = function () {\n                            window.location.href = res.login_url;\n                        };\n                        if (success) {\n                            success({status: 'success', finish: finishAuth, redirectUrl: res.login_url});\n                        } else {\n                            finishAuth();\n                        }\n                    } else {\n                        error(this.createErrorObject('Login or pass not valid', INCORRECT_LOGIN_OR_PASSWORD_ERROR_CODE));\n                    }\n                }, function (err) {\n                    error(err);\n                });\n            } else if (prop.authType == 'sms') {\n                if (smsAuthStep == 'phone') {\n                    this.api.smsAuth(prop.phoneNumber, null, null);\n                } else if (smsAuthStep == 'code') {\n\n                }\n            } else {\n                console.error('Unknown auth type');\n            }\n        }\n    }\n\n    createErrorObject(message, code) {\n        return {\n            error: {\n                message: message,\n                code: code || -1\n            }\n        };\n    };\n\n    getProjectId() {\n        return this.config.projectId;\n    };\n\n    getRedirectURL() {\n        return this.config.redirectUrl;\n    };\n\n    getTheme() {\n        return this.config.theme;\n    }\n\n    getCallbackUrl() {\n        if (this.config.loginUrl) return this.config.loginUrl;\n        else return this.config.callbackUrl\n    };\n\n    getIframeSrc(options = {}) {\n        const widgetBaseUrl = options.widgetBaseUrl || this.config.widgetBaseUrl;\n\n        const route = options.route || this.config.route;\n\n        let src = widgetBaseUrl + route + '?projectId=' + this.getProjectId();\n\n        if (this.config.locale) {\n            src = src + '&locale=' + this.config.locale;\n        }\n        if (this.config.fields) {\n            src = src + '&fields=' + this.config.fields;\n        }\n        const redirectUrl = this.getRedirectURL();\n        if (redirectUrl) {\n            src = src + '&redirectUrl=' + encodeURIComponent(redirectUrl);\n        }\n\n        const callbackUrl = this.getCallbackUrl();\n\n        if (callbackUrl) {\n            src = src + '&login_url=' + encodeURIComponent(callbackUrl);\n        }\n\n        const theme = this.getTheme();\n        if (theme) {\n            src = src + '&theme=' + encodeURIComponent(theme);\n        }\n\n        return src;\n    }\n\n    AuthWidget(elementId, options) {\n        if (this.api) {\n            if (!elementId) {\n                console.error('No div name!');\n            } else {\n                if (options == undefined) {\n                    options = {};\n                }\n                const width = `${options.width || 400}px`;\n                const height = `${options.height || 550}px`;\n\n                widgetIframe.onload = () => {\n                    element.removeChild(preloader);\n                    widgetIframe.style.width = '100%';\n                    widgetIframe.style.height = '100%';\n                    let event = new CustomEvent('load');\n                    this.dispatcher.dispatchEvent(event);\n                };\n                widgetIframe.style.width = 0;\n                widgetIframe.style.height = 0;\n                widgetIframe.frameBorder = '0';\n                widgetIframe.src = this.getIframeSrc(options);\n                widgetIframe.id = IFRAME_ID;\n\n\n\n                const preloader = document.createElement('div');\n\n                preloader.innerHTML = this.config.preloader;\n\n                const element = document.getElementById(elementId);\n                if (element) {\n                    element.style.width = width;\n                    element.style.height = height;\n                    element.appendChild(preloader);\n                    element.appendChild(widgetIframe);\n                } else {\n                    console.error('Element \\\"' + elementId + '\\\" not found!');\n                }\n\n            }\n        } else {\n            console.error('Please run XL.init() first');\n        }\n    };\n\n    onCloseEvent() {\n        widgetIframe.parentNode.removeChild(widgetIframe);\n    }\n\n    _hide() {\n        widgetIframe.style.position = '';\n        widgetIframe.style.zIndex = '';\n        widgetIframe.style.left = '';\n        widgetIframe.style.top = '';\n        widgetIframe.style.width = 0;\n        widgetIframe.style.height = 0;\n        widgetIframe.style.backgroundColor = '';\n    }\n\n    onHideEvent() {\n       this._hide();\n    }\n\n    /**\n     * link event with handler\n     * @param event\n     * @param handler\n     */\n\n    on(event, handler) {\n        handler = handler || null;\n\n        if (event === this.eventTypes.CLOSE) {\n            if (!handler) {\n                handler = this.onCloseEvent;\n            }\n            else {\n                this.dispatcher.removeEventListener(event, this.onCloseEvent);\n            }\n        }\n\n        this.dispatcher.addEventListener(event, handler);\n    };\n\n    _show() {\n        widgetIframe.style.position = 'fixed';\n        widgetIframe.style.zIndex = this.config.iframeZIndex;\n        widgetIframe.style.left = '0';\n        widgetIframe.style.top = '0';\n        widgetIframe.style.width = '100%';\n        widgetIframe.style.height = '100%';\n        widgetIframe.style.backgroundColor = this.config.popupBackgroundColor;\n    }\n\n    /**\n     * open fullsreen popup for widget\n     */\n\n    show() {\n        if (!document.getElementById(IFRAME_ID)) {\n            widgetIframe.src = this.getIframeSrc();\n            widgetIframe.id = IFRAME_ID;\n            widgetIframe.style.width = 0;\n            widgetIframe.style.height = 0;\n            widgetIframe.frameBorder = '0';\n\n            widgetIframe.onload = () => {\n                let event = new CustomEvent('load');\n                this.dispatcher.dispatchEvent(event);\n            };\n            this._show();\n\n            document.body.appendChild(widgetIframe);\n        } else {\n            this._show();\n        }\n    };\n}\n\nconst result = new XL();\n\nmodule.exports = result;"],"sourceRoot":"."}