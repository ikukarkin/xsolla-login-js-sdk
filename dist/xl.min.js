!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).XL=e()}}(function(){return function r(s,a,l){function u(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var o=a[t]={exports:{}};s[t][0].call(o.exports,function(e){return u(s[t][1][e]||e)},o,o.exports,r,s,a,l)}return a[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){"use strict";if(String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),"function"!=typeof window.CustomEvent){var i=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};i.prototype=window.Event.prototype,window.CustomEvent=i}},{}],2:[function(e,t,n){"use strict";var i=function(e,t){var o=this;this.baseUrl=t||"//login.xsolla.com/api/",this.projectId=e,this.makeApiCall=function(e,t,n){var i=new XMLHttpRequest;i.withCredentials=!0,i.open(e.method,o.baseUrl+e.endpoint,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?t(JSON.parse(i.responseText)):i.responseText?n(JSON.parse(i.responseText)):n({error:{message:"Networking error",code:i.status}}))},"POST"==e.method?(i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(e.postBody)):"GET"==e.method&&i.send(e.getArguments)}};i.prototype.getSocialsURLs=function(e,t,n){var i="";for(var o in n)""!=i&&(i+="&"),i+=o+"="+encodeURIComponent(n[o]);return this.makeApiCall({method:"GET",endpoint:"social/login_urls?"+i,getArguments:null},e,t)},i.prototype.loginPassAuth=function(e,t,n,i,o,r){var s={username:e,password:t,remember_me:n};return this.makeApiCall({method:"POST",endpoint:"proxy/login?projectId="+this.projectId+"&redirect_url="+encodeURIComponent(i),postBody:JSON.stringify(s)},o,r)},i.prototype.smsAuth=function(e,t,n){return this.makeApiCall({method:"GET",endpoint:"sms",getArguments:"phoneNumber="+e},t,n)},t.exports=i},{}],main:[function(e,t,n){"use strict";var i,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=e("./xlapi"),a=(i=r)&&i.__esModule?i:{default:i};e("./supports");var l={errorHandler:function(e){},loginPassValidator:function(e,t){return!0},isMarkupSocialsHandlersEnabled:!1,apiUrl:"//login.xsolla.com/api/",maxXLClickDepth:20,onlyWidgets:!1,theme:"app.default.css",preloader:"<div></div>"},u=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socialUrls={},this.eventTypes={LOAD:"load",CLOSE:"close"},this.ROUTES={LOGIN:"",REGISTRATION:"registration",RECOVER_PASSWORD:"reset-password",ALL_SOCIALS:"other"},this.dispatcher=document.createElement("div")}return o(e,[{key:"init",value:function(e){var o=this;if(this.config=s({},l,e),this.api=new a.default(e.projectId,this.config.apiUrl),Object.keys(this.eventTypes).map(function(e){o.on(o.eventTypes[e])}),!this.config.onlyWidgets){var t={};t.projectId=e.projectId,this.config.redirectUrl&&(t.redirect_url=this.config.redirectUrl),this.config.loginUrl&&(t.login_url=this.config.loginUrl);var n=function(){o.api.getSocialsURLs(function(e){for(var t in o.socialUrls={},e)e.hasOwnProperty(t)&&(o.socialUrls["sn-"+t]=e[t])},function(e){console.error(e)},t)};n(),setInterval(n,354e4);var r=this.config.maxXLClickDepth;this.config.isMarkupSocialsHandlersEnabled&&document.addEventListener("click",function(e){var t=function(e){if(e.attributes["data-xl-auth"])return e;for(var t=0;(e=e.parentElement)&&!e.attributes["data-xl-auth"]&&++t<r;);return e}(e.target);if(t){var n=t.attributes["data-xl-auth"];if(n){var i=n.nodeValue;i&&o.login({authType:i})}}})}}},{key:"login",value:function(e,n,i){var o=this;e&&this.socialUrls&&(e.authType&&(e.authType.startsWith("sn-")?null!=this.socialUrls[e.authType]?window.location.href=this.socialUrls[e.authType]:console.error("Auth type: "+e.authType+" doesn't exist"):"login-pass"==e.authType?this.api.loginPassAuth(e.login,e.pass,e.rememberMe,this.config.redirectUrl,function(e){if(e.login_url){var t=function(){window.location.href=e.login_url};i?i({status:"success",finish:t,redirectUrl:e.login_url}):t()}else n(o.createErrorObject("Login or pass not valid",2))},function(e){n(e)}):"sms"==e.authType?"phone"==smsAuthStep?this.api.smsAuth(e.phoneNumber,null,null):smsAuthStep:console.error("Unknown auth type")))}},{key:"createErrorObject",value:function(e,t){return{error:{message:e,code:t||-1}}}},{key:"getProjectId",value:function(){return this.config.projectId}},{key:"getRedirectURL",value:function(){return this.config.redirectUrl}},{key:"getTheme",value:function(){return this.config.theme}},{key:"getLoginUrl",value:function(){return this.config.loginUrl}},{key:"AuthWidget",value:function(e,t){var n=this;if(this.api)if(e){null==t&&(t={});var i=(t.width||400)+"px",o=(t.height||550)+"px",r=(t.widgetBaseUrl||"https://xl-widget.xsolla.com/")+(t.route||this.ROUTES.LOGIN)+"?projectId="+this.getProjectId();this.config.locale&&(r=r+"&locale="+this.config.locale),this.config.fields&&(r=r+"&fields="+this.config.fields);var s=this.getRedirectURL();s&&(r=r+"&redirectUrl="+encodeURIComponent(s));var a=this.getLoginUrl();a&&(r=r+"&login_url="+encodeURIComponent(a));var l=this.getTheme();l&&(r=r+"&theme="+encodeURIComponent(l));var u=document.createElement("iframe");u.onload=function(){p.removeChild(d),u.style.width="100%",u.style.height="100%";var e=new CustomEvent("load");n.dispatcher.dispatchEvent(e)},u.style.width=0,u.style.height=0,u.frameBorder="0",u.src=r,u.id="XsollaLoginWidgetIframe";var c=window.addEventListener?"addEventListener":"attachEvent";(0,window[c])("attachEvent"==c?"onmessage":"message",function(e){var t=new CustomEvent(n.eventTypes[e.data]);n.dispatcher.dispatchEvent(t)},!1);var d=document.createElement("div");d.innerHTML=this.config.preloader;var p=document.getElementById(e);p?(p.style.width=i,p.style.height=o,p.appendChild(d),p.appendChild(u)):console.error('Element "'+e+'" not found!')}else console.error("No div name!");else console.error("Please run XL.init() first")}},{key:"onCloseEvent",value:function(){var e=document.getElementById("XsollaLoginWidgetIframe");e.parentNode.removeChild(e)}},{key:"on",value:function(e,t){t=t||null,e===this.eventTypes.CLOSE&&(t?this.dispatcher.removeEventListener(e,this.onCloseEvent):t=this.onCloseEvent),this.dispatcher.addEventListener(e,t)}}]),e}());t.exports=u},{"./supports":1,"./xlapi":2}]},{},["main"])("main")});
//# sourceMappingURL=xl.min.js.map